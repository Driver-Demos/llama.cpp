# Purpose
The provided Python script is a command-line tool designed to compare performance data from multiple runs of a benchmarking tool called "llama-bench." It processes data stored in various formats, including JSON, JSONL, CSV, and SQLite databases, and generates a comparative table of performance metrics between different commits in a Git repository. The script is structured to handle command-line arguments for specifying baseline and comparison commits, input files, and output formats. It uses libraries such as GitPython for Git operations, tabulate for table formatting, and SQLite3 for database interactions.

The script defines several classes to handle different data formats, each extending a base class that provides common functionality for data processing. These classes include methods for validating data formats, extracting relevant data, and computing performance metrics. The script also includes logic to determine which columns to display based on user input or data variability, and it formats the output table with human-readable headers and calculated speedup values. The tool is intended for use in environments where performance comparisons across different code versions are necessary, providing a structured and automated way to analyze and present benchmarking results.
# Imports and Dependencies

---
- `logging`
- `argparse`
- `heapq`
- `sys`
- `os`
- `glob.glob`
- `sqlite3`
- `json`
- `csv`
- `typing.Optional`
- `typing.Union`
- `collections.abc.Iterator`
- `collections.abc.Sequence`
- `git`
- `tabulate.tabulate`


# Global Variables

---
### logger
- **Type**: `logging.Logger`
- **Description**: The `logger` variable is an instance of a `Logger` object obtained from the Python `logging` module. It is configured to handle logging for the application with the name 'compare-llama-bench', which suggests it is used for logging messages related to the comparison of llama-bench performance data.
- **Use**: This variable is used to log messages, including errors and warnings, throughout the script to aid in debugging and monitoring the application's execution.


---
### DB\_FIELDS
- **Type**: `list`
- **Description**: `DB_FIELDS` is a list of strings representing the names of fields used in the llama-bench SQL database. These fields correspond to various attributes and metrics related to the performance and configuration of machine learning models and hardware setups.
- **Use**: This variable is used to define the schema of the database table where performance data is stored and queried.


---
### DB\_TYPES
- **Type**: `list`
- **Description**: `DB_TYPES` is a list of strings that represent the data types for each field in a database schema used in the llama-bench application. The list contains data types such as 'TEXT', 'INTEGER', and 'REAL', which correspond to the fields defined in the `DB_FIELDS` list.
- **Use**: This variable is used to define the data types for the fields in a SQL table, ensuring that each field in the database has the correct type for storing its respective data.


---
### KEY\_PROPERTIES
- **Type**: `list`
- **Description**: `KEY_PROPERTIES` is a list of strings that represent various properties related to system and model configurations used in the llama-bench benchmarking tool. These properties include information about CPU, GPU, model type, batch sizes, and other configuration settings that are relevant for differentiating benchmarking results.
- **Use**: This variable is used to specify the properties by which benchmarking results are differentiated per commit in the llama-bench tool.


---
### BOOL\_PROPERTIES
- **Type**: `list`
- **Description**: `BOOL_PROPERTIES` is a list of strings, each representing a property that is boolean in nature. These properties are used to differentiate results in a table by converting them to 'Yes' or 'No' values.
- **Use**: This variable is used to identify which properties should be displayed as boolean values in the output table.


---
### PRETTY\_NAMES
- **Type**: `dict`
- **Description**: The `PRETTY_NAMES` variable is a dictionary that maps internal field names used in the llama-bench data processing to more human-readable names. This mapping is used to create more understandable headers for tables and reports generated by the script.
- **Use**: This variable is used to translate internal field names into user-friendly names for display in tables and reports.


---
### DEFAULT\_SHOW
- **Type**: `list`
- **Description**: `DEFAULT_SHOW` is a list containing the string 'model_type'. It specifies properties that should always be displayed by default in the output tables generated by the script.
- **Use**: This variable is used to define which properties are always shown in the output tables by default.


---
### DEFAULT\_HIDE
- **Type**: `list`
- **Description**: `DEFAULT_HIDE` is a list containing the string 'model_filename'. It is used to specify properties that should be hidden by default when displaying data tables.
- **Use**: This variable is used to determine which properties are hidden by default in the output tables generated by the script.


---
### GPU\_NAME\_STRIP
- **Type**: `list`
- **Description**: `GPU_NAME_STRIP` is a list of strings that contains prefixes of GPU names such as 'NVIDIA GeForce ', 'Tesla ', and 'AMD Radeon '. These prefixes are used to identify and strip specific parts of GPU names in order to create more concise representations in tables.
- **Use**: This variable is used to remove specific GPU name prefixes to simplify and shorten the representation of GPU names in output tables.


---
### MODEL\_SUFFIX\_REPLACE
- **Type**: `dict`
- **Description**: `MODEL_SUFFIX_REPLACE` is a dictionary that maps specific model size suffixes to their abbreviated forms. It replaces the suffixes ' - Small', ' - Medium', and ' - Large' with '_S', '_M', and '_L' respectively.
- **Use**: This variable is used to standardize model size suffixes in model type strings by replacing verbose suffixes with shorter abbreviations.


---
### DESCRIPTION
- **Type**: `str`
- **Description**: The `DESCRIPTION` variable is a multi-line string that provides a detailed explanation of how to create tables from llama-bench data stored in various file formats such as JSON, CSV, JSONL, or SQLite databases. It includes example usage instructions for Linux systems, detailing the steps to checkout branches, clean and build llama-bench, and run the benchmark tool with SQLite integration.
- **Use**: This variable is used as the description for the argparse.ArgumentParser, providing users with guidance on how to use the script.


---
### parser
- **Type**: `argparse.ArgumentParser`
- **Description**: The `parser` variable is an instance of `argparse.ArgumentParser` that is configured to parse command-line arguments for a script. It uses a description provided by the `DESCRIPTION` variable and a formatter class `argparse.RawDescriptionHelpFormatter` to format the help message.
- **Use**: This variable is used to define and handle command-line arguments for the script, allowing users to specify options like baseline and compare commits, input files, output format, and verbosity.


---
### help\_b
- **Type**: `str`
- **Description**: The variable `help_b` is a string that provides a description for the command-line argument `--baseline` in an argument parser. It explains that the baseline commit is used for performance comparison and can be specified using a branch name, tag name, or commit hash. If not specified, it defaults to the latest master commit with data.
- **Use**: This variable is used as the help text for the `--baseline` command-line argument in the argument parser.


---
### help\_c
- **Type**: `str`
- **Description**: The variable `help_c` is a string that provides a description for a command-line argument used in a script. It explains that the argument specifies the commit whose performance is to be compared to a baseline, and it can accept a branch name, tag name, or commit hash. By default, it uses the most recent non-master commit for which llama-bench was run.
- **Use**: This variable is used as the help text for the `--compare` command-line argument in an argument parser.


---
### help\_i
- **Type**: `str`
- **Description**: The `help_i` variable is a string that provides a detailed description for the input argument of a command-line interface. It explains the types of files that can be used for comparing commits, the ability to specify multiple input files, and the default behavior when no input file is specified.
- **Use**: This variable is used as the help text for the `-i` or `--input` argument in the argument parser, guiding users on how to specify input files for the script.


---
### help\_o
- **Type**: `str`
- **Description**: The `help_o` variable is a string that provides a description for the output format option in a command-line interface. It specifies that the default output format for the table is 'pipe', which is compatible with GitHub, and mentions that other formats like 'latex' or 'mediawiki' are also supported. The string also refers to the tabulate documentation for a full list of supported formats.
- **Use**: This variable is used as the help text for the '-o' or '--output' argument in the argument parser, guiding users on how to specify the output format for the table.


---
### help\_s
- **Type**: `str`
- **Description**: The `help_s` variable is a string that provides a detailed description of the `--show` command-line argument for a script. It explains the purpose of the argument, which is to specify additional columns to be added to a table, and lists the legal values that can be used.
- **Use**: This variable is used as the help text for the `--show` argument in the command-line parser, guiding users on how to specify columns for table output.


---
### known\_args
- **Type**: `argparse.Namespace`
- **Description**: The `known_args` variable is an instance of `argparse.Namespace` that stores the parsed command-line arguments recognized by the `argparse.ArgumentParser` object. It contains the values for the arguments defined in the script, such as `baseline`, `compare`, `input`, `output`, `show`, `check`, and `verbose`. These arguments are used to control the behavior of the script, such as specifying input files, output format, and verbosity level.
- **Use**: This variable is used to access the command-line arguments that have been successfully parsed and recognized by the script.


---
### unknown\_args
- **Type**: `list`
- **Description**: The `unknown_args` variable is a list that contains any command-line arguments that were not recognized by the `argparse` parser when parsing the input arguments. This is achieved using the `parse_known_args()` method, which separates known arguments into `known_args` and unknown ones into `unknown_args`. This allows the program to handle or report unrecognized arguments separately.
- **Use**: This variable is used to capture and handle any unrecognized command-line arguments passed to the script.


---
### input\_file
- **Type**: `list`
- **Description**: The `input_file` variable is a list that is initially assigned the value of `known_args.input`, which is expected to be a list of file paths provided as command-line arguments. If `known_args.input` is not provided or is empty, the code attempts to set `input_file` to a default SQLite file path or to a list of SQLite files found in the current directory.
- **Use**: This variable is used to store the list of input files that will be processed by the script to compare performance data.


---
### bench\_data
- **Type**: `Optional[Union[LlamaBenchDataSQLite3File, LlamaBenchDataJSON, LlamaBenchDataJSONL, LlamaBenchDataCSV]]`
- **Description**: The `bench_data` variable is a global variable that is initially set to `None` and later assigned an instance of one of the classes `LlamaBenchDataSQLite3File`, `LlamaBenchDataJSON`, `LlamaBenchDataJSONL`, or `LlamaBenchDataCSV` based on the format of the input file(s). These classes are responsible for handling and processing data from different file formats related to llama-bench performance data.
- **Use**: This variable is used to store and manage the llama-bench data from the input files, allowing the program to perform operations such as data validation, processing, and comparison.


---
### hexsha8\_baseline
- **Type**: `NoneType`
- **Description**: The variable `hexsha8_baseline` is initialized to `None` and is intended to store a shortened hexadecimal SHA-1 hash (hexsha8) of a Git commit that serves as the baseline for performance comparison. It is initially set to `None` to indicate that no baseline commit has been identified yet.
- **Use**: This variable is used to store the baseline commit's hexsha8 value for performance comparison in the script.


---
### name\_baseline
- **Type**: `str`
- **Description**: The `name_baseline` variable is a string that holds the human-readable name of a baseline commit. It is derived from the `hexsha8_baseline`, which is an 8-character hexadecimal SHA-1 hash of the baseline commit. The name is obtained using the `get_commit_name` method of the `bench_data` object, which attempts to find a more descriptive name for the commit, such as a branch or tag name, if available.
- **Use**: This variable is used to store and display the name of the baseline commit for performance comparison purposes.


---
### hexsha8\_compare
- **Type**: `NoneType`
- **Description**: The variable `hexsha8_compare` is a global variable initialized to `None`. It is intended to store a shortened hexadecimal SHA-1 hash (hexsha8) of a commit that is being compared against a baseline in a version control system, likely Git.
- **Use**: This variable is used to hold the commit hash of the target commit for comparison in the benchmarking process.


---
### name\_compare
- **Type**: `str`
- **Description**: The variable `name_compare` is a string that holds the human-readable name of a commit. It is derived from the `hexsha8_compare` variable, which represents a shortened commit hash. The name is obtained using the `get_commit_name` method of the `bench_data` object, which attempts to find a more descriptive name for the commit, such as a branch or tag name, if available.
- **Use**: This variable is used to store and display a user-friendly name for the commit being compared in performance analysis.


---
### table
- **Type**: `list`
- **Description**: The `table` variable is a list that is intended to store rows of data, each representing a comparison of performance metrics between two different commits or builds. Each row in the list contains various properties and calculated values, such as test names, average time per second values, and speedup ratios.
- **Use**: This variable is used to accumulate and organize data rows for output in a tabular format, which is then printed using the `tabulate` library.


---
### headers
- **Type**: `list`
- **Description**: The `headers` variable is a list that contains the column headers for a table. It is constructed by first mapping the `show` list of properties to their corresponding pretty names using the `PRETTY_NAMES` dictionary. Additional headers are appended to the list, including 'Test', 't/s' values for baseline and compare, and 'Speedup'.
- **Use**: This variable is used to define the column headers for a table that displays performance comparison data.


# Classes

---
### LlamaBenchData<!-- {{#class:llama.cpp/scripts/compare-llama-bench.LlamaBenchData}} -->
- **Members**:
    - `repo`: An optional git.Repo object representing the repository.
    - `build_len_min`: The minimum length of the build commit hash.
    - `build_len_max`: The maximum length of the build commit hash.
    - `build_len`: The current length of the build commit hash, defaulting to 8.
    - `builds`: A list of strings representing build commit hashes.
    - `check_keys`: A set of keys required for data validation.
- **Description**: The LlamaBenchData class is designed to manage and process data related to benchmarking builds in a git repository. It initializes with an optional git repository and maintains information about build commit hashes, including their lengths and a list of builds. The class also includes a set of keys for validating data entries, ensuring that all necessary properties are present. It provides methods to find parent commits, retrieve commit names, and manage build data, facilitating the comparison of performance metrics across different builds.
- **Methods**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.__init__`](#LlamaBenchData__init__)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData._builds_init`](#LlamaBenchData_builds_init)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData._check_keys`](#LlamaBenchData_check_keys)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.find_parent_in_data`](#LlamaBenchDatafind_parent_in_data)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.get_all_parent_hexsha8s`](#LlamaBenchDataget_all_parent_hexsha8s)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.get_commit_name`](#LlamaBenchDataget_commit_name)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.get_commit_hexsha8`](#LlamaBenchDataget_commit_hexsha8)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.builds_timestamp`](#LlamaBenchDatabuilds_timestamp)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.get_rows`](#LlamaBenchDataget_rows)

**Methods**

---
#### LlamaBenchData\.\_\_init\_\_<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchData.__init__}} -->
The `__init__` method initializes an instance of the `LlamaBenchData` class by attempting to set up a Git repository object for the current directory.
- **Inputs**: None
- **Control Flow**:
    - The method attempts to initialize a Git repository object using `git.Repo` with the current directory as the target and allows searching in parent directories.
    - If the initialization of the Git repository fails due to an `InvalidGitRepositoryError`, the `repo` attribute is set to `None`.
- **Output**: The method does not return any value; it initializes the `repo` attribute of the class instance.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData`](#cpp/scripts/compare-llama-benchLlamaBenchData)  (Base Class)


---
#### LlamaBenchData\.\_builds\_init<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchData._builds_init}} -->
The `_builds_init` method initializes the `build_len` attribute to the value of `build_len_min`.
- **Inputs**: None
- **Control Flow**:
    - The method sets the `build_len` attribute of the instance to the value of `build_len_min`.
- **Output**: The method does not return any value; it modifies the instance's `build_len` attribute.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData`](#cpp/scripts/compare-llama-benchLlamaBenchData)  (Base Class)


---
#### LlamaBenchData\.\_check\_keys<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchData._check_keys}} -->
The `_check_keys` method checks if a given set of keys contains all required keys and returns any missing keys.
- **Inputs**:
    - `keys`: A set of keys to be checked against the required keys defined in `self.check_keys`.
- **Control Flow**:
    - The method checks if the provided `keys` set is a superset of `self.check_keys`.
    - If `keys` is not a superset, it calculates and returns the difference between `self.check_keys` and `keys`, which represents the missing keys.
    - If `keys` is a superset, it returns `None`, indicating no keys are missing.
- **Output**: Returns a set of missing keys if any are missing, otherwise returns `None`.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData`](#cpp/scripts/compare-llama-benchLlamaBenchData)  (Base Class)


---
#### LlamaBenchData\.find\_parent\_in\_data<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchData.find_parent_in_data}} -->
The `find_parent_in_data` method finds the most recent parent commit with data available, measured by the number of commits, starting from a given commit.
- **Inputs**:
    - `commit`: A `git.Commit` object representing the starting commit from which to search for a parent with data.
- **Control Flow**:
    - Initialize a heap with a tuple containing depth 0 and the given commit.
    - Create an empty set to track seen commit hashes (hexsha8).
    - While the heap is not empty, pop the smallest element (by depth) from the heap.
    - Extract the current commit's hexsha8 and check if it exists in the `builds` list.
    - If the current hexsha8 is found in `builds`, return it as the result.
    - If not found, iterate over the current commit's parents.
    - For each parent, compute its hexsha8 and check if it has been seen before.
    - If a parent's hexsha8 has not been seen, add it to the seen set and push it onto the heap with incremented depth.
    - If no parent with data is found after exhausting the heap, return `None`.
- **Output**: Returns the hexsha8 of the most recent parent commit with data if found, otherwise returns `None`.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData`](#cpp/scripts/compare-llama-benchLlamaBenchData)  (Base Class)


---
#### LlamaBenchData\.get\_all\_parent\_hexsha8s<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchData.get_all_parent_hexsha8s}} -->
The `get_all_parent_hexsha8s` method retrieves the abbreviated hexsha values of all parent commits for a given commit in a Git repository.
- **Inputs**:
    - `commit`: A `git.Commit` object representing the commit whose parent hexsha8 values are to be retrieved.
- **Control Flow**:
    - Initialize a list `unvisited` with the input `commit` and an empty list `visited`.
    - Enter a while loop that continues as long as there are commits in the `unvisited` list.
    - Pop the first commit from `unvisited` and append its abbreviated hexsha (up to `self.build_len` characters) to the `visited` list.
    - Iterate over the parents of the current commit.
    - For each parent, if its abbreviated hexsha is not already in `visited`, append it to `unvisited`.
- **Output**: A sequence of strings, each representing the abbreviated hexsha of a parent commit, including the initial commit.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData`](#cpp/scripts/compare-llama-benchLlamaBenchData)  (Base Class)


---
#### LlamaBenchData\.get\_commit\_name<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchData.get_commit_name}} -->
The `get_commit_name` method attempts to find a human-readable name for a given commit hash by checking the repository's heads and tags.
- **Inputs**:
    - `hexsha8`: A string representing the first 8 characters of a commit's SHA-1 hash.
- **Control Flow**:
    - Check if the `repo` attribute is `None`; if so, return the input `hexsha8` as the commit name.
    - Iterate over the repository's heads to find a head whose commit's hash matches `hexsha8`; if found, return the head's name.
    - If no matching head is found, iterate over the repository's tags to find a tag whose commit's hash matches `hexsha8`; if found, return the tag's name.
    - If no matching head or tag is found, return the input `hexsha8` as the commit name.
- **Output**: Returns a string that is either a human-readable name for the commit or the original `hexsha8` if no name is found.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData`](#cpp/scripts/compare-llama-benchLlamaBenchData)  (Base Class)


---
#### LlamaBenchData\.get\_commit\_hexsha8<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchData.get_commit_hexsha8}} -->
The `get_commit_hexsha8` method searches for a commit's abbreviated hash (hexsha8) using a human-readable name within a Git repository.
- **Inputs**:
    - `name`: A string representing the human-readable name of a commit, which could be a branch name, tag name, or a partial commit hash.
- **Control Flow**:
    - Check if the `repo` attribute is `None`, and return `None` if it is.
    - Iterate over the repository's heads (branches) to find a head with a name matching the input `name`.
    - If a matching head is found, return the first `build_len` characters of its commit's hexsha.
    - Iterate over the repository's tags to find a tag with a name matching the input `name`.
    - If a matching tag is found, return the first `build_len` characters of its commit's hexsha.
    - Iterate over all commits in the repository to find a commit whose hexsha matches the input `name` up to `build_len` characters.
    - If a matching commit is found, return the first `build_len` characters of its hexsha.
    - Return `None` if no matching commit is found.
- **Output**: Returns an optional string, which is the first `build_len` characters of the commit's hexsha if a match is found, or `None` if no match is found.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData`](#cpp/scripts/compare-llama-benchLlamaBenchData)  (Base Class)


---
#### LlamaBenchData\.builds\_timestamp<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchData.builds_timestamp}} -->
The `builds_timestamp` method returns rows of (build_commit, test_time) sorted by test_time, optionally in reverse order.
- **Inputs**:
    - `reverse`: A boolean flag indicating whether the results should be returned in reverse order.
- **Control Flow**:
    - The method executes a SQL query to select build_commit and test_time from the test table, ordered by test_time.
    - If the reverse flag is set to True, the result is reversed before being returned.
    - The method returns the data as either an iterator or a sequence, depending on the reverse flag.
- **Output**: An iterator or sequence of tuples, each containing a build_commit and its corresponding test_time, sorted by test_time.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData`](#cpp/scripts/compare-llama-benchLlamaBenchData)  (Base Class)


---
#### LlamaBenchData\.get\_rows<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchData.get_rows}} -->
The `get_rows` method retrieves and processes table rows based on specified properties and commit identifiers, ensuring unique property combinations and averaging certain values.
- **Inputs**:
    - `properties`: A list of strings representing the properties by which the rows should be grouped and compared.
    - `hexsha8_baseline`: A string representing the baseline commit's abbreviated hash (first 8 characters).
    - `hexsha8_compare`: A string representing the compare commit's abbreviated hash (first 8 characters).
- **Control Flow**:
    - The method is intended to retrieve rows from a data source where all specified properties are equal between two commits.
    - It groups the resulting rows by the provided properties and averages the t/s values.
    - The method ensures that the returned rows are unique in terms of property combinations.
- **Output**: A sequence of tuples, each representing a unique combination of properties with averaged values.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData`](#cpp/scripts/compare-llama-benchLlamaBenchData)  (Base Class)



---
### LlamaBenchDataSQLite3<!-- {{#class:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3}} -->
- **Members**:
    - `connection`: Holds the SQLite3 connection object for database operations.
    - `cursor`: Holds the SQLite3 cursor object for executing SQL commands.
- **Description**: The LlamaBenchDataSQLite3 class extends LlamaBenchData to provide functionality for managing and querying llama-bench data stored in an SQLite3 database. It initializes an in-memory SQLite3 database, creates a table based on predefined fields and types, and provides methods to initialize build data, retrieve build timestamps, and fetch rows of data for comparison based on specified properties. This class is designed to facilitate performance comparisons between different builds by leveraging SQL queries to manipulate and analyze the data.
- **Methods**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3.__init__`](#LlamaBenchDataSQLite3__init__)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3._builds_init`](#LlamaBenchDataSQLite3_builds_init)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3.builds_timestamp`](#LlamaBenchDataSQLite3builds_timestamp)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3.get_rows`](#LlamaBenchDataSQLite3get_rows)
- **Inherits From**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData`](#cpp/scripts/compare-llama-benchLlamaBenchData)

**Methods**

---
#### LlamaBenchDataSQLite3\.\_\_init\_\_<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3.__init__}} -->
The [`__init__`](#LlamaBenchData__init__) method initializes an in-memory SQLite database and creates a table with specified fields and types.
- **Inputs**: None
- **Control Flow**:
    - Calls the parent class's [`__init__`](#LlamaBenchData__init__) method using `super().__init__()` to ensure proper initialization of the base class.
    - Establishes a connection to an in-memory SQLite database using `sqlite3.connect(':memory:')`.
    - Creates a cursor object from the database connection to execute SQL commands.
    - Executes an SQL command to create a table named 'test' with columns defined by `DB_FIELDS` and their corresponding types from `DB_TYPES`.
- **Output**: This method does not return any value; it sets up the initial state of the object by creating a database connection and a table.
- **Functions called**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.__init__`](#LlamaBenchData__init__)
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3`](#cpp/scripts/compare-llama-benchLlamaBenchDataSQLite3)  (Base Class)


---
#### LlamaBenchDataSQLite3\.\_builds\_init<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3._builds_init}} -->
The [`_builds_init`](#LlamaBenchData_builds_init) method initializes build-related data by ensuring consistent commit hash lengths and populating a list of unique build commits from a SQLite database.
- **Inputs**: None
- **Control Flow**:
    - Check if there is an active database connection.
    - Retrieve the minimum and maximum lengths of the `build_commit` field from the `test` table.
    - If the minimum and maximum lengths differ, log a warning and truncate all `build_commit` entries to the minimum length.
    - Fetch all distinct `build_commit` values from the `test` table and store them in the `self.builds` list.
    - Call the superclass's [`_builds_init`](#LlamaBenchData_builds_init) method.
- **Output**: The method does not return any value; it modifies the instance's state by setting `self.build_len_min`, `self.build_len_max`, and `self.builds`.
- **Functions called**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData._builds_init`](#LlamaBenchData_builds_init)
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3`](#cpp/scripts/compare-llama-benchLlamaBenchDataSQLite3)  (Base Class)


---
#### LlamaBenchDataSQLite3\.builds\_timestamp<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3.builds_timestamp}} -->
The `builds_timestamp` method retrieves and optionally reverses a list of tuples containing build commit identifiers and their corresponding test times from a SQLite database.
- **Inputs**:
    - `reverse`: A boolean flag that determines whether the returned data should be reversed; defaults to False.
- **Control Flow**:
    - Execute an SQL query to select 'build_commit' and 'test_time' from the 'test' table, ordered by 'test_time'.
    - Fetch all results from the executed query into a list of tuples.
    - Return the list of tuples in reverse order if 'reverse' is True, otherwise return it as is.
- **Output**: Returns either an iterator or a sequence of tuples, each containing a 'build_commit' and 'test_time', ordered by 'test_time' unless reversed.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3`](#cpp/scripts/compare-llama-benchLlamaBenchDataSQLite3)  (Base Class)


---
#### LlamaBenchDataSQLite3\.get\_rows<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3.get_rows}} -->
The `get_rows` method retrieves and returns rows from a SQLite database table by executing a SQL query that selects, groups, and orders data based on specified properties and commit hashes.
- **Inputs**:
    - `properties`: A list of strings representing the properties to be included in the SQL SELECT, GROUP BY, and ORDER BY clauses.
    - `hexsha8_baseline`: A string representing the baseline commit hash (first 8 characters) to be used in the SQL WHERE clause.
    - `hexsha8_compare`: A string representing the compare commit hash (first 8 characters) to be used in the SQL WHERE clause.
- **Control Flow**:
    - Constructs a SELECT clause string by joining the specified properties with additional fixed columns and aggregate functions.
    - Constructs an equality condition string for the SQL JOIN clause using the specified commit hashes and key properties.
    - Constructs a GROUP BY and ORDER BY clause string using the specified properties and additional fixed columns.
    - Forms a complete SQL query string by combining the SELECT, JOIN, GROUP BY, and ORDER BY clauses.
    - Executes the SQL query using the cursor and fetches all resulting rows.
- **Output**: A sequence of tuples, each representing a row of data retrieved from the database based on the specified properties and commit hashes.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3`](#cpp/scripts/compare-llama-benchLlamaBenchDataSQLite3)  (Base Class)



---
### LlamaBenchDataSQLite3File<!-- {{#class:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3File}} -->
- **Description**: The `LlamaBenchDataSQLite3File` class is a specialized subclass of `LlamaBenchDataSQLite3` designed to handle SQLite3 database files for llama-bench data. It initializes a connection to a specified SQLite3 file, replacing the in-memory database connection established by its parent class. The class also provides a static method to validate the format of the SQLite3 file, ensuring it is a valid and non-empty database. This class is part of a system for comparing performance data across different commits in a version control system.
- **Methods**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3File.__init__`](#LlamaBenchDataSQLite3File__init__)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3File.valid_format`](#LlamaBenchDataSQLite3Filevalid_format)
- **Inherits From**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3`](#cpp/scripts/compare-llama-benchLlamaBenchDataSQLite3)

**Methods**

---
#### LlamaBenchDataSQLite3File\.\_\_init\_\_<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3File.__init__}} -->
The [`__init__`](#LlamaBenchData__init__) method initializes a `LlamaBenchDataSQLite3File` object by setting up a connection to a specified SQLite database file and preparing the database cursor.
- **Inputs**:
    - `data_file`: A string representing the path to the SQLite database file to connect to.
- **Control Flow**:
    - Calls the parent class's [`__init__`](#LlamaBenchData__init__) method using `super().__init__()` to initialize inherited attributes.
    - Closes any existing database connection using `self.connection.close()`.
    - Establishes a new SQLite database connection using `sqlite3.connect(data_file)` and assigns it to `self.connection`.
    - Creates a new database cursor from the connection using `self.connection.cursor()` and assigns it to `self.cursor`.
    - Calls the `_builds_init()` method to perform additional initialization tasks specific to the class.
- **Output**: This method does not return any value; it initializes the object state.
- **Functions called**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.__init__`](#LlamaBenchData__init__)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData._builds_init`](#LlamaBenchData_builds_init)
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3File`](#cpp/scripts/compare-llama-benchLlamaBenchDataSQLite3File)  (Base Class)


---
#### LlamaBenchDataSQLite3File\.valid\_format<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3File.valid_format}} -->
The `valid_format` method checks if a given file is a valid SQLite3 database file by attempting to connect and query its schema version.
- **Decorators**: `@staticmethod`
- **Inputs**:
    - `data_file`: A string representing the path to the SQLite3 database file to be validated.
- **Control Flow**:
    - Establish a connection to the SQLite3 database using the provided file path.
    - Create a cursor object to execute SQL commands.
    - Attempt to execute a PRAGMA command to fetch the schema version of the database.
    - If the schema version is 0, raise a DatabaseError indicating the file is empty or non-existent.
    - Catch any DatabaseError exceptions, log a debug message indicating the file is not a valid SQLite3 file, and set the cursor to None.
    - Close the database connection.
    - Return True if the cursor is not None, indicating the file is a valid SQLite3 database, otherwise return False.
- **Output**: A boolean value indicating whether the file is a valid SQLite3 database (True) or not (False).
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3File`](#cpp/scripts/compare-llama-benchLlamaBenchDataSQLite3File)  (Base Class)



---
### LlamaBenchDataJSONL<!-- {{#class:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSONL}} -->
- **Description**: The `LlamaBenchDataJSONL` class is a specialized subclass of `LlamaBenchDataSQLite3` designed to handle JSONL (JSON Lines) formatted data files. It reads data from a specified JSONL file, validates the presence of required keys, and inserts the data into an in-memory SQLite database for further processing. The class also provides a static method to verify if a given file is a valid JSONL file, ensuring that the data can be correctly parsed and utilized.
- **Methods**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSONL.__init__`](#LlamaBenchDataJSONL__init__)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSONL.valid_format`](#LlamaBenchDataJSONLvalid_format)
- **Inherits From**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3`](#cpp/scripts/compare-llama-benchLlamaBenchDataSQLite3)

**Methods**

---
#### LlamaBenchDataJSONL\.\_\_init\_\_<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSONL.__init__}} -->
The [`__init__`](#LlamaBenchDataSQLite3File__init__) method initializes an instance of the `LlamaBenchDataJSONL` class by reading a JSONL file, validating and inserting its data into an in-memory SQLite database, and performing initial setup.
- **Inputs**:
    - `data_file`: A string representing the path to the JSONL file containing the data to be processed and inserted into the SQLite database.
- **Control Flow**:
    - The method begins by calling the superclass's [`__init__`](#LlamaBenchDataSQLite3File__init__) method to ensure proper initialization of the parent class.
    - It opens the specified JSONL file in read mode with UTF-8 encoding.
    - The method iterates over each line in the file, parsing it as JSON data.
    - For each parsed JSON object, it removes any keys not present in the predefined `DB_FIELDS`.
    - It checks for any missing required keys using the [`_check_keys`](#LlamaBenchData_check_keys) method and raises a `RuntimeError` if any are missing.
    - If the JSON object is valid, it constructs and executes an SQL `INSERT` statement to add the data to the `test` table in the SQLite database.
    - Finally, it calls the [`_builds_init`](#LlamaBenchDataSQLite3_builds_init) method to perform additional initialization tasks.
- **Output**: The method does not return any value, but it initializes the object with data from the JSONL file inserted into the SQLite database.
- **Functions called**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3File.__init__`](#LlamaBenchDataSQLite3File__init__)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData._check_keys`](#LlamaBenchData_check_keys)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3._builds_init`](#LlamaBenchDataSQLite3_builds_init)
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSONL`](#cpp/scripts/compare-llama-benchLlamaBenchDataJSONL)  (Base Class)


---
#### LlamaBenchDataJSONL\.valid\_format<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSONL.valid_format}} -->
The `valid_format` method checks if a given file is a valid JSONL file by attempting to parse its first line as JSON.
- **Decorators**: `@staticmethod`
- **Inputs**:
    - `data_file`: A string representing the path to the file to be validated.
- **Control Flow**:
    - The method attempts to open the file specified by `data_file` in read mode with UTF-8 encoding.
    - It iterates over the lines in the file, attempting to parse the first line as JSON using `json.loads`.
    - If parsing is successful, the loop breaks immediately, indicating the file is valid.
    - If an exception occurs during file opening or JSON parsing, it logs a debug message indicating the file is not a valid JSONL file and returns `False`.
    - If no exception occurs, the method returns `True`, indicating the file is a valid JSONL file.
- **Output**: A boolean value indicating whether the file is a valid JSONL file (`True`) or not (`False`).
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSONL`](#cpp/scripts/compare-llama-benchLlamaBenchDataJSONL)  (Base Class)



---
### LlamaBenchDataJSON<!-- {{#class:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSON}} -->
- **Description**: The `LlamaBenchDataJSON` class is a specialized subclass of `LlamaBenchDataSQLite3` designed to handle and process benchmark data stored in JSON files. It reads multiple JSON files, validates their format, and inserts the parsed data into an in-memory SQLite database. The class ensures that only the required fields are retained and checks for any missing keys necessary for the data processing. It also provides a static method to verify if the provided files are valid JSON files.
- **Methods**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSON.__init__`](#LlamaBenchDataJSON__init__)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSON.valid_format`](#LlamaBenchDataJSONvalid_format)
- **Inherits From**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3`](#cpp/scripts/compare-llama-benchLlamaBenchDataSQLite3)

**Methods**

---
#### LlamaBenchDataJSON\.\_\_init\_\_<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSON.__init__}} -->
The [`__init__`](#LlamaBenchData__init__) method initializes an instance of the `LlamaBenchDataJSON` class by loading JSON data from specified files, validating and filtering the data, and inserting it into an in-memory SQLite database.
- **Inputs**:
    - `data_files`: A list of strings representing the file paths to JSON files containing data to be loaded and processed.
- **Control Flow**:
    - The method begins by calling the superclass's [`__init__`](#LlamaBenchData__init__) method to initialize the base class.
    - It iterates over each file path in the `data_files` list.
    - For each file, it opens the file in read mode with UTF-8 encoding and loads the JSON data.
    - It iterates over each entry in the parsed JSON data.
    - For each entry, it removes any keys that are not in the predefined `DB_FIELDS` set.
    - It checks for any missing required keys using the [`_check_keys`](#LlamaBenchData_check_keys) method and raises a `RuntimeError` if any are missing.
    - It inserts the filtered entry into the SQLite database using an SQL `INSERT` statement.
    - After processing all files, it calls the [`_builds_init`](#LlamaBenchDataSQLite3_builds_init) method to finalize initialization.
- **Output**: The method does not return any value; it initializes the object state by populating the SQLite database with the processed data.
- **Functions called**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.__init__`](#LlamaBenchData__init__)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData._check_keys`](#LlamaBenchData_check_keys)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3._builds_init`](#LlamaBenchDataSQLite3_builds_init)
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSON`](#cpp/scripts/compare-llama-benchLlamaBenchDataJSON)  (Base Class)


---
#### LlamaBenchDataJSON\.valid\_format<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSON.valid_format}} -->
The `valid_format` method checks if a list of file paths all point to valid JSON files.
- **Decorators**: `@staticmethod`
- **Inputs**:
    - `data_files`: A list of strings representing file paths to be checked for valid JSON format.
- **Control Flow**:
    - Check if the input list `data_files` is empty; if so, return `False`.
    - Iterate over each file path in `data_files`.
    - For each file, attempt to open it and load its contents as JSON.
    - If any file fails to load as JSON, log a debug message and return `False`.
    - If all files are successfully loaded as JSON, return `True`.
- **Output**: Returns a boolean value: `True` if all files are valid JSON files, otherwise `False`.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataJSON`](#cpp/scripts/compare-llama-benchLlamaBenchDataJSON)  (Base Class)



---
### LlamaBenchDataCSV<!-- {{#class:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataCSV}} -->
- **Description**: The `LlamaBenchDataCSV` class is a specialized subclass of `LlamaBenchDataSQLite3` designed to handle CSV data files. It reads CSV files, validates their format, and inserts the parsed data into an in-memory SQLite database for further processing. The class ensures that only the required fields are retained and checks for any missing keys necessary for data integrity. It also provides a static method to verify if the given files are valid CSV files.
- **Methods**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataCSV.__init__`](#LlamaBenchDataCSV__init__)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataCSV.valid_format`](#LlamaBenchDataCSVvalid_format)
- **Inherits From**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3`](#cpp/scripts/compare-llama-benchLlamaBenchDataSQLite3)

**Methods**

---
#### LlamaBenchDataCSV\.\_\_init\_\_<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataCSV.__init__}} -->
The [`__init__`](#LlamaBenchData__init__) method initializes an instance of the `LlamaBenchDataCSV` class by reading CSV files, validating and filtering their data, and inserting it into an in-memory SQLite database.
- **Inputs**:
    - `data_files`: A list of strings representing the file paths to the CSV files to be processed.
- **Control Flow**:
    - The method begins by calling the superclass's [`__init__`](#LlamaBenchData__init__) method to initialize the base class.
    - It iterates over each file path in the `data_files` list.
    - For each file, it opens the file in read mode with UTF-8 encoding.
    - It uses `csv.DictReader` to parse the CSV file into dictionaries, iterating over each row.
    - For each row, it collects the keys and removes any keys not present in the `DB_FIELDS` set.
    - It checks for any missing required keys using the [`_check_keys`](#LlamaBenchData_check_keys) method and raises a `RuntimeError` if any are missing.
    - It executes an SQL `INSERT` statement to add the filtered row data into the `test` table of the SQLite database.
    - After processing all files, it calls the [`_builds_init`](#LlamaBenchDataSQLite3_builds_init) method to finalize initialization.
- **Output**: The method does not return any value; it initializes the object state by populating the SQLite database with data from the provided CSV files.
- **Functions called**:
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData.__init__`](#LlamaBenchData__init__)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchData._check_keys`](#LlamaBenchData_check_keys)
    - [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataSQLite3._builds_init`](#LlamaBenchDataSQLite3_builds_init)
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataCSV`](#cpp/scripts/compare-llama-benchLlamaBenchDataCSV)  (Base Class)


---
#### LlamaBenchDataCSV\.valid\_format<!-- {{#callable:llama.cpp/scripts/compare-llama-bench.LlamaBenchDataCSV.valid_format}} -->
The `valid_format` method checks if a list of CSV files are valid by attempting to read them using `csv.DictReader`.
- **Decorators**: `@staticmethod`
- **Inputs**:
    - `data_files`: A list of strings representing the file paths to the CSV files to be validated.
- **Control Flow**:
    - Check if the `data_files` list is empty; if so, return `False`.
    - Iterate over each file path in `data_files`.
    - For each file, attempt to open it and read the first line using `csv.DictReader`.
    - If an exception occurs during file reading, log a debug message and return `False`.
    - If all files are successfully read without exceptions, return `True`.
- **Output**: Returns `True` if all files are valid CSV files, otherwise returns `False`.
- **See also**: [`llama.cpp/scripts/compare-llama-bench.LlamaBenchDataCSV`](#cpp/scripts/compare-llama-benchLlamaBenchDataCSV)  (Base Class)



