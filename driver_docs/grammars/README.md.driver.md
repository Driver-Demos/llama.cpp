# Purpose
The provided content is a comprehensive guide for GBNF (GGML BNF), a format used to define formal grammars that constrain model outputs in the `llama.cpp` software. This file serves a narrow yet crucial function by allowing users to specify how model outputs should be structured, such as ensuring outputs are valid JSON or consist solely of emojis. The document explains the syntax and semantics of GBNF, including production rules, non-terminals, terminals, sequences, alternatives, and repetition, which are essential for defining grammars. It also details how GBNF can be used in conjunction with JSON schemas, providing a bridge between JSON schema definitions and GBNF grammars. This guide is relevant to the codebase as it enables developers to enforce specific output formats from models, enhancing the control and predictability of model-generated content.
# Content Summary
The provided document is a comprehensive guide to GBNF (GGML BNF), a format used for defining formal grammars to constrain model outputs in `llama.cpp`. GBNF is an extension of the Backus-Naur Form (BNF), incorporating modern regex-like features to describe the syntax of formal languages. This guide is essential for developers who need to enforce specific output formats, such as valid JSON or emoji-only responses, from models using `llama.cpp`.

Key components of GBNF include production rules, non-terminals, and terminals. Production rules define how non-terminals (rule names) can be replaced with sequences of terminals (characters) and other non-terminals. The document provides an example using a chess notation grammar to illustrate these concepts. Non-terminals are represented by dashed lowercase words, while terminals are actual characters or character ranges, supporting the full range of Unicode.

The guide also explains sequences and alternatives, where the order of symbols in a sequence is crucial, and alternatives provide different acceptable sequences. Repetition and optional symbols are denoted by operators like `*`, `+`, `?`, and curly braces `{}` for specific repetition counts. Comments in GBNF are marked with `#`, and newlines are permissible between rules and symbols.

The `root` rule is a critical aspect of any GBNF grammar, defining the starting point and overall pattern that the output must match. The document also covers the use of GBNF grammars in various tools within the `llama.cpp` ecosystem, such as `llama-server` and `llama-cli`, and provides instructions for converting JSON schemas to GBNF grammars.

Additionally, the guide addresses troubleshooting and performance considerations, particularly regarding optional repetitions and efficient grammar usage. It highlights known limitations and unsupported features when converting JSON schemas to GBNF, advising developers to use command-line tools for conversion and validation.

Overall, this document serves as a detailed reference for developers working with GBNF in `llama.cpp`, providing the necessary technical details to define and implement formal grammars effectively.
